name: Periodic Health Check

on:
  schedule:
    - cron: '*/5 * * * *' # runs every 5 minutes
  workflow_dispatch: # allows manual trigger

jobs:
  health_check:
    runs-on: ubuntu-latest

    steps:
      - name: Check application status
        uses: dawidd6/action-http-status-check@v2
        with:
          url: https://pokedex-m83o.onrender.com/health
          success-codes: '200'
          retries: 2
          retry-delay: 5
        id: health

      - name: Notify Discord if app is down
        if: failure()
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: "❌ Health check failed! The application may be down."
          
      - name: Notify Discord if app is healthy
        if: success()
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: "✅ Health check passed. Application is running smoothly."
